# CMake file for exporting common libraries
cmake_minimum_required(VERSION 3.20)

project(common_lib_tests)
# This is not a project, but the tests are a project.

set(CMAKE_CXX_STANDARD 17) # cpp 2017 standard
set(CMAKE_CXX_STANDARD_REQUIRED True)

add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/../submodules/Catch2 ${CMAKE_CURRENT_BINARY_DIR}/submodules/Catch2) # Include Catch2 for unit tests

set(BUILD_DIR ${CMAKE_CURRENT_LIST_DIR}/build)

set(COMMON_LIB_SOURCES 
    ${CMAKE_CURRENT_LIST_DIR}/example/some_lib.cpp
    ${CMAKE_CURRENT_LIST_DIR}/low_pass_fir_filter/low_pass_fir_filter.cpp
    # Autogenerated files:
    # ${BUILD_DIR}/autogen/*.cpp
    # ${BUILD_DIR}/autogen/*.c
)

add_library(common_lib STATIC ${COMMON_LIB_SOURCES})

target_include_directories(common_lib PUBLIC
    ${CMAKE_CURRENT_LIST_DIR}/example/
    ${CMAKE_CURRENT_LIST_DIR}/low_pass_fir_filter/
)

add_executable(common_lib_tests
    ${CMAKE_CURRENT_LIST_DIR}/example/test/test_some_lib.cpp ${CMAKE_CURRENT_LIST_DIR}/low_pass_fir_filter/test/test_low_pass_fir_filter.cpp)


target_link_libraries(common_lib_tests PRIVATE
    common_lib
    Catch2::Catch2WithMain)

target_compile_options(common_lib_tests PRIVATE 
    -Wall
    -Wextra
    # -Werror # Uncomment to be verry strict
)

include(CTest)
include(Catch)
catch_discover_tests(common_lib_tests)